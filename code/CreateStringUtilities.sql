IF Object_Id('dbo.Splitter', 'FT') IS NOT NULL
DROP FUNCTION [dbo].[Splitter];
GO

IF EXISTS (
	SELECT
		*
	FROM
		sys.assemblies
	WHERE
		name = 'StringUtilities'
)
DROP ASSEMBLY StringUtilities;

CREATE ASSEMBLY StringUtilities 
AUTHORIZATION dbo 
-- you can use the DLL instead if you substitute for your path:
-- FROM 'C:\sisula\code\Splitter.dll' 
-- or you can use the binary representation of the compiled code:
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103008C8322540000000000000000E00002210B0108000012000000060000000000007E310000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000020040850000100000100000000010000010000000000000100000000000000000000000303100004B00000000400000A802000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000084110000002000000012000000020000000000000000000000000000200000602E72737263000000A8020000004000000004000000140000000000000000000000000000400000402E72656C6F6300000C00000000600000000200000018000000000000000000000000000040000042000000000000000000000000000000006031000000000000480000000200050038220000F80E000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001E02280100000A2A1E02280400000A2AA6730600000A8001000004730700000A8002000004730800000A8003000004730900000A80040000042A0000133001000B000000010000117E010000046F0A00000A2A00133001000B000000020000117E020000046F0B00000A2A00133001000B000000030000117E030000046F0C00000A2A00133001000B000000040000117E040000046F0D00000A2A00133002000D000000050000110203281100000A281200000A2A00000013300100070000000600001102281300000A2A00133001000B00000007000011D005000002281400000A2A0013300100070000000800001102281500000A2A00133001001000000009000011028C0100001B2D06280100002B2A022A13300200100000000A000011031200FE150200001B06810200001B2A1E02281700000A2A13300200280000000B000011027B1900000A6F1A00000A0B078C0300001B2D12280200002B0B027B1900000A076F1B00000A072A4A02281700000A02731C00000A7D1900000A2A001E02281700000A2A133003000E0000000C000011020316281E00000A6F1F00000A2A000013300300380000000D0000110274190000010A066F2000000A7E2100000A16282200000A16330A0314732300000A512B1203066F2000000A282400000A732500000A512A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000B8050000237E000024060000FC05000023537472696E677300000000200C00000800000023555300280C0000100000002347554944000000380C0000C002000023426C6F6200000000000000020000015715A209090E000000FA01330016000001000000200000000700000005000000130000000700000028000000270000000D0000000200000005000000050000000900000001000000040000000200000003000000020000000000EC050100000000000A00AB0081000A00DF00C1000600EF00E8000A00470181000600C501E8000A0047021D0206007F026C020E00C302AE021200F402DE0212000D03DE0212003A0322030600640351030A00A3037C030A00BB0313001200F003D30306002504050406004304E80006006704E8000A00800413000600CE04AF0412000105E20412000705E20412000D05E20412001A05E20412003505E2040E003B05AE0212004505E20406004D05E8000A005A057C030E0099057E050600AE0505040600CE05050400000000010000000000010001000000000029003700050001000100000000003A00370009000100020000011000450037000D0001000300050100004F0000000D0005000800050100005D0000000D0005000F0001000000780000000D000600110031000A012000310033012D00310055013A0031007A0147002100560290005020000000000618BB00130001005820000000000618BB00130001006020000000001118F600170001008C20000000001308FD001B000100A420000000001308230128000100BC200000000013084C0135000100D4200000000013086A0142000100EC20000000004602B001630001000821000000004602B901680002001C21000000008300CA016C0002003421000000004602D201710002004821000000001100DB01780002006421000000000100F901800003008021000000000618BB001300040088210000000003080D028B000400BC21000000000618BB0013000400D021000000000618BB0013000400D8210000000016008B029D000400F421000000001600CC02A400060000000100B70100000100F00100000100F001000001009602000002009A0200000100D40200000200D8020900BB0013004900BB00AC005900BB00BB001100BB0013006100BB0013002400BB0013002C00BB0013003400BB0013003C00BB00130024000D028B002C000D028B0034000D028B003C000D028B006900BB0013007100BB0013007900BB000E018100340459011900B00163001900B90168002900550466011900D20171009100710476011900BB0013009900BB0086014400560290004C009B048B004C00A50403024C00BB001300A100BB001002A90007051B02B1002A052402D9009B047100E10054052E02E900640531024100BB003802D10072053E024100BB004402F100BB001300F900BB0092020101BB0013002900830013012E004301A0022E003B01970240002B00D90040001300B20043001300B20043001B00C10049008300310163001300B20063001B00C10069008300240180002B00D90083001B00C10083007300D90083007B00D900890083004501A0002B00D900A300C3008E01A3001300B200C0002B00D900C300EB001502C3001300B200E0002B00D90000012B00D90000011300B20020012B00D90020011300B20040012B00D90040011300B20060012B00D90060011300B20080012B00D900A0012B00D900C0011300B200C0012B00D900E0012B00D90000022B00D90000021300B200400233015102FA00FF00040109015E0162016D01720181018101090229024A0204000100060005000000DF004F000000980154000000470159000000A4015E0000006002980002000400030002000500050002000600070002000700090002000F000B00750075008800DE00E500EC00F300F001F7010480000000000000000000000000000000007800000002000000000000000000000001000A00000000000800000000000000000000000A001300000000000200000000000000000000000100A202000000000200000000000000000000000100E800000000000500040006000400000010000C00EE01000010001900EE01000000001B00EE012D007C012D00FE010000003C4D6F64756C653E006D73636F726C6962004D6963726F736F66742E56697375616C4261736963004D794170706C69636174696F6E004D79004D79436F6D7075746572004D7950726F6A656374004D79576562536572766963657300546872656164536166654F626A65637450726F766964657260310053706C6974746572004D6963726F736F66742E56697375616C42617369632E4170706C69636174696F6E5365727669636573004170706C69636174696F6E42617365002E63746F72004D6963726F736F66742E56697375616C42617369632E4465766963657300436F6D70757465720053797374656D004F626A656374002E6363746F72006765745F436F6D7075746572006D5F436F6D70757465724F626A65637450726F7669646572006765745F4170706C69636174696F6E006D5F4170704F626A65637450726F76696465720055736572006765745F55736572006D5F557365724F626A65637450726F7669646572006765745F5765625365727669636573006D5F4D7957656253657276696365734F626A65637450726F7669646572004170706C69636174696F6E00576562536572766963657300457175616C73006F0047657448617368436F64650054797065004765745479706500546F537472696E67004372656174655F5F496E7374616E63655F5F005400696E7374616E636500446973706F73655F5F496E7374616E63655F5F006765745F476574496E7374616E6365004D6963726F736F66742E56697375616C42617369632E4D7953657276696365732E496E7465726E616C00436F6E7465787456616C75656031006D5F436F6E7465787400476574496E7374616E63650053797374656D2E436F6C6C656374696F6E730049456E756D657261626C6500496E69744D6574686F6400726F77007061747465726E0053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C43686172730046696C6C526F77006F626A006D617463680053797374656D2E436F6D706F6E656E744D6F64656C00456469746F7242726F777361626C6541747472696275746500456469746F7242726F777361626C6553746174650053797374656D2E436F6465446F6D2E436F6D70696C65720047656E657261746564436F64654174747269627574650053797374656D2E446961676E6F737469637300446562756767657248696464656E417474726962757465004D6963726F736F66742E56697375616C42617369632E436F6D70696C65725365727669636573005374616E646172644D6F64756C6541747472696275746500486964654D6F64756C654E616D654174747269627574650053797374656D2E436F6D706F6E656E744D6F64656C2E44657369676E0048656C704B6579776F72644174747269627574650053797374656D2E52756E74696D652E436F6D70696C657253657276696365730052756E74696D6548656C70657273004765744F626A65637456616C75650052756E74696D655479706548616E646C65004765745479706546726F6D48616E646C6500416374697661746F7200437265617465496E7374616E6365004D7947726F7570436F6C6C656374696F6E417474726962757465006765745F56616C7565007365745F56616C75650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C654174747269627574650053797374656D2E546578742E526567756C617245787072657373696F6E73005265676578004D617463680052656765784F7074696F6E730047726F7570436F6C6C656374696F6E006765745F47726F7570730047726F75700053716C537472696E67004361707475726500537472696E6700456D707479004F70657261746F727300436F6D70617265537472696E67006F705F496D706C69636974004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053706C69747465722E646C6C000000000003200000000000F7D572426210D741A6B245C59130E75E0008B77A5C561934E08908B03F5F7F11D50A3A0320000103000001040000120C070615121801120C040000120807061512180112080400001211070615121801121104000012140706151218011214040800120C040800120804080012110408001214042001021C0320000804200012150320000E021E00071001011E001E000730010101101E00021300042000130007061512190113000428001300060002121D0E0E070002011C101221052001011129080100010000000000052002010E0E1701000A4D7954656D706C61746507382E302E302E30000004010000000615121801120C061512180112080615121801121106151218011214040701120C040701120804070112110407011214042001010E1001000B4D792E436F6D707574657200000C0100074D792E5573657200001301000E4D792E4170706C69636174696F6E00001301000E4D792E576562536572766963657300000400011C1C03070102030701080600011215114504070112150307010E051001001E00040A011E000407011E00072004010E0E0E0E6101003453797374656D2E5765622E53657276696365732E50726F746F636F6C732E536F617048747470436C69656E7450726F746F636F6C124372656174655F5F496E7374616E63655F5F13446973706F73655F5F496E7374616E63655F5F0000000615121801130006151219011300040A01130005200101130006070213001300042001010205010000000008000312590E0E115D0420001261040701121D02060E060003080E0E02052001011D0305000111690E052001011169060702126511694001000300540E1146696C6C526F774D6574686F644E616D650746696C6C526F7754020F497344657465726D696E6973746963015402094973507265636973650104200101080801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301005831000000000000000000006E310000002000000000000000000000000000000000000000000000603100000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000004C02000000000000000000004C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004AC010000010053007400720069006E006700460069006C00650049006E0066006F0000008801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000003C000D00010049006E007400650072006E0061006C004E0061006D0065000000530070006C00690074007400650072002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000044000D0001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530070006C00690074007400650072002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000803100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE;
GO

CREATE FUNCTION Splitter(@row AS nvarchar(max), @pattern AS nvarchar(555))
RETURNS TABLE (
	[match] nvarchar(max)
) AS EXTERNAL NAME StringUtilities.Splitter.InitMethod;
GO

sp_configure 'clr enabled', 1
GO
reconfigure with override
GO

/*
with strgen as (
	select
		'Hello World' as s,
		1 as n
	union all 
	select
		s,
		n + 1
	from 
		strgen
	where
		n < 100000
)
select
	*
from 
	strgen
cross apply (
	select 
		[match],
		ROW_NUMBER() OVER (ORDER BY (SELECT 1)) as i
	from
		dbo.Splitter(N'Hello World', N'(.{2}).*(Wo)(rl).*')
) s
pivot (
	max(match) for i in ([2], [3], [4], [5])
) p
option (maxrecursion 0);
*/




